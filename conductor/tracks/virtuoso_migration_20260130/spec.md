# Specification: Migrating Feeds to React Virtuoso\n\n## Overview\nThis track involves replacing the current 'react-window' virtualization implementation with 'react-virtuoso'. The primary goal is to leverage Virtuoso's superior handling of dynamic item heights (essential for image/video-heavy social feeds) and its simplified API for infinite scrolling.\n\n## Problem Statement\nThe current 'react-window' setup requires complex manual re-measurement logic and 'AutoSizer' wrappers, which have led to layout bugs (blank feeds) and performance bottlenecks.\n\n## Functional Requirements\n- **Dynamic Height Support:** Replace the manual 'ResizeObserver' and 'resetAfterIndex' logic with Virtuoso's automatic self-measurement.\n- **Infinite Scrolling:** Utilize Virtuoso's 'endReached' callback to trigger 'onLoadMore' precisely when the user nears the bottom of the feed.\n- **Stable Initial Render:** Ensure the first batch of events renders immediately without flickering or layout jumps.\n- **Header Integration:** Maintain the existing layout where headers (FeedComposer, etc.) are outside the virtualized list but correctly interact with the scroll container if necessary.\n\n## Non-Functional Requirements\n- **Performance:** Smooth 60fps scrolling on both desktop and mobile.\n- **Reliability:** Eliminate the 'blank feed' issues caused by container height calculation errors.\n- **Developer Experience:** Reduce boilerplate in 'VirtualFeed.tsx'.\n\n## Acceptance Criteria\n- Feeds (Global and Community) render correctly with diverse post heights.\n- Fast scrolling does not cause overlapping or significant 'empty space' flicker.\n- 'Load More' triggers automatically and smoothly appends new content.\n- The 'VirtualFeed' component is significantly smaller and more maintainable.\n\n## Out of Scope\n- Implementing sticky headers within the list.\n- Changing the 'Post' component's internal logic.\n- Adding 'Scroll to Top' features (save for a future track).
